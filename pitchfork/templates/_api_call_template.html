{% if call_loop %}
    {% for api_call in call_loop %}
        {% set call_fixed_title = api_call.get('title')|lower|slug %}
        {% if not api_call.get('prod_title') %}
            {% set prod_fixed_title = title|lower|slug %}
        {% else %}
            {% set prod_fixed_title = api_call.get('prod_title')|lower|slug %}
        {% endif %}
        <div class="panel panel-default anchor" id="{{ call_fixed_title }}-{{ prod_fixed_title }}" target="{{ slugify(call_fixed_title) }}">
            <div class="panel-title">
                <h4>
                    {% if api_call.get('prod_title') %}{{ api_call.get('prod_title') }} - {% endif %}{{ api_call.get('title') }}
                    <a class="prod-popover" data-toggle="popover" data-placement="top" data-content="{{ request.url_root }}{% if api_call.get('app_link') %}{{ api_call.get('app_link')|remove_slash }}{% else %}{{ api_settings.app_url|remove_slash }}{% endif %}/#{{ call_fixed_title }}-{{ prod_fixed_title }}"><span class="fa fa-link tooltip-title" data-placement="right" title="View Direct Call Link"></span></a>
                    <button data-title="{{ call_fixed_title }}-{{ prod_fixed_title }}" data-loop="{{ loop.index }}" id="toggle_details" class="toggle-element-{{ loop.index }} btn btn-primary">Call Details</a>
                </h4>
                <div id="api_description">
                    {{ api_call.get('short_description')|nl2br|tab2spaces|safe }}
                </div>
            </div>
            <div class="panel-body">
                <div id="total_api_wrap">
                    <div id="api_call_inner" class="{{ call_fixed_title }}-{{ prod_fixed_title }}" style="display: none;">
                        <dl class="dl-horizontal">
                            <dt>Endpoint:</dt>
                            <dd>
                                {% if api_call.get('endpoint') %}
                                    {{ api_call.get('endpoint') }}
                                {% else %}
                                    {{ api_settings.us_api }}
                                {% endif %}
                            </dd>
                            <dt>URI:</dt>
                            <dd>
                                {{ api_call.get('api_uri') }}
                            </dd>
                            {% if api_call.get('add_to_header') %}
                                <dt>Add Header:</dt>
                                <dd>{{ api_call.get('custom_header_key') }}: {{ api_call.get('custom_header_value') }}</dd>
                            {% endif %}
                            <dt>Verb:</dt>
                            <dd>
                                {{ api_call.get('verb') }}
                            </dd>
                            <dt>Docs:</dt>
                            <dd>
                                {% if api_call.get('doc_url') %}
                                    <span class="basic-values"><a href="{{ api_call.get('doc_url') }}" class="tooltip-title" target="_blank" title="View Documentation">API Reference Document</a></span>
                                {% else %}
                                    <span class="basic-values">No Documentation Linked</span>
                                {% endif %}
                            </dd>
                        </dl>
                        {% if api_call.get('verb')|lower == 'post' or api_call.get('verb')|lower == 'put' or api_call.get('verb')|lower == 'delete' %}
                            <p class="danger-note text-danger">Note: This action can be destructive, or result in additional charges to a customers account. Please proceed with caution.</p>
                        {% endif %}
                        {% if api_call.get('variables') %}
                            <form class="{{ call_fixed_title }}-{{ prod_fixed_title }}_form" id="{{ call_fixed_title }}-{{ prod_fixed_title }}_form" method="POST">
                                <input id="api_url" name="api_url" type="hidden" value="{{ api_call.get('api_uri') }}">
                                <input id="api_verb" name="api_verb" type="hidden" value="{{ api_call.get('verb') }}">
                                <input id="api_id" name="api_id" type="hidden" value="{{ api_call.get('_id') }}">
                                <input id="app_url_link" name="app_url_link" type="hidden" value="{{ api_call.get('app_link') }}">
                                <input id="api_endpoint" name="api_endpoint" type="hidden" value="{{ api_call.get('endpoint') }}">
                                <table class="table">
                                    <tr>
                                        <th>Parameter</th>
                                        <th></th>
                                        <th>Type</th>
                                        <th style="text-align: center;">Required</th>
                                        <th>Description</th>
                                    </tr>
                                    {% for var in api_call.get('variables') %}
                                        <tr>
                                            <td>
                                                {{ var.get('variable_name') }}
                                            </td>
                                            <td{% if var.get('required') %} class="text-danger"{% endif %}>
                                                {% if var.get('field_display') == 'TextField' %}
                                                    <input id="{{ var.get('variable_name') }}" name="{{ var.get('variable_name') }}" type="text" placeholder="{{ var.get('variable_name')|unslug|title }}">
                                                {% elif var.get('field_display') == 'SelectField' %}
                                                    <select id="{{ var.get('variable_name') }}" name="{{ var.get('variable_name') }}">
                                                        {% for var in parse_field_data(var.get('field_display_data')) %}
                                                            <option value="{{ var }}">{{ var }}</option>
                                                        {% endfor %}
                                                    </select>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {{ var.get('field_type') }}
                                            </td>
                                            <td style="text-align: center;">
                                                {% if var.get('required') %}
                                                    <span class="text-danger">Yes</span>
                                                {% else %}
                                                    No
                                                {% endif %}
                                            </td>
                                            <td>
                                                {{ var.get('description') }}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </table>
                                <p style="font-size: 12px;"><span class="text-danger">*</span> Required for API Call</p>
                                {% if session.get('username') %}
                                    <input name="{{ call_fixed_title }}-{{ prod_fixed_title }}" class="api_call_submit btn btn-warning" type="submit" value="Send API Call">
                                {% endif %}
                                <input name="{{ call_fixed_title }}-{{ prod_fixed_title }}" class="api_call_submit btn btn-info" type="submit" value="Mock API Call">
                            </form>
                            <div id="loading_div_{{ call_fixed_title }}-{{ prod_fixed_title }}" class="loading-div" style="display: none;">
                                Executing Call&nbsp;<span class="fa fa-spin fa-spinner text-info"></span>
                            </div>
                        {% else %}
                            <form class="{{ call_fixed_title }}-{{ prod_fixed_title }}_form" action="" id="{{ call_fixed_title }}-{{ prod_fixed_title }}_form" method="POST">
                                <input id="api_url" name="api_url" type="hidden" value="{{ api_call.get('api_uri') }}">
                                <input id="api_verb" name="api_verb" type="hidden" value="{{ api_call.get('verb') }}">
                                <input id="api_id" name="api_id" type="hidden" value="{{ api_call.get('_id') }}">
                                <input id="app_url_link" name="app_url_link" type="hidden" value="{{ api_call.get('app_link') }}">
                                <input id="api_endpoint" name="api_endpoint" type="hidden" value="{{ api_call.get('endpoint') }}">
                                {% if session.get('username') %}
                                    <input name="{{ call_fixed_title }}-{{ prod_fixed_title }}" class="api_call_submit btn btn-warning" type="submit" value="Send API Call">
                                {% endif %}
                                <input name="{{ call_fixed_title }}-{{ prod_fixed_title }}" class="api_call_submit btn btn-info no-var-btn" type="submit" value="Mock API Call">
                            </form>
                            <div id="loading_div_{{ call_fixed_title }}-{{ prod_fixed_title }}" class="loading-div" style="display: none;">
                                Executing Call&nbsp;<span class="fa fa-spin fa-spinner text-info"></span>
                            </div>
                        {% endif %}
                        <div id="api_results_wrapper_{{ call_fixed_title }}-{{ prod_fixed_title }}" class="code-blocks-wrapper" style="display: none">
                            <div id="api_uri">
                                <h5>Request URL</h5>
                                <div class="code-block" id="api_url_{{ call_fixed_title }}-{{ prod_fixed_title }}">
                                    URL Here
                                </div>
                            </div>
                            <div id="api_headers">
                                <h5>Request Headers</h5>
                                <div class="code-block" id="api_headers_{{ call_fixed_title }}-{{ prod_fixed_title }}">
                                    Request Headers Here
                                </div>
                            </div>
                            <div id="api_body_wrapper_{{ call_fixed_title }}-{{ prod_fixed_title }}" style="display: none;">
                                <h5>Request Data Object</h5>
                                <div class="code-block" id="api_body_{{ call_fixed_title }}-{{ prod_fixed_title }}">
                                    Data Object if any
                                </div>
                            </div>
                            <div id="api_response_headers" class="response-headers-{{ call_fixed_title }}-{{ prod_fixed_title }}">
                                <h5>Response Headers</h5>
                                <div class="code-block" id="api_response_headers_{{ call_fixed_title }}-{{ prod_fixed_title }}">
                                    Response Code
                                    Request ID
                                </div>
                            </div>
                            <div id="api_response_body" class="response-body-{{ call_fixed_title }}-{{ prod_fixed_title }}">
                                <h5>Response Body</h5>
                                <div class="code-block" id="api_content_{{ call_fixed_title }}-{{ prod_fixed_title }}">
                                    Body Here
                                </div>
                            </div>
                            <div id="show_hide" class="in-api">
                                <button data-title="{{ call_fixed_title }}-{{ prod_fixed_title }}" data-loop="{{ loop.index }}" data-results="true" id="toggle_results" class="toggle-element-{{ loop.index }} btn btn-primary">Hide Results</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endfor %}
{% else %}
    <div class="panel panel-danger">
        <div class="panel-heading">
            <strong>Warning!</strong> No API calls were found to display
        </div>
    </div>
{% endif %}
